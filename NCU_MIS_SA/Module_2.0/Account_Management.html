<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <link rel="stylesheet" href="../statics/css/Home.css">
    <link rel="stylesheet" href="../statics/css/Module_2.0.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script src="../statics/js/loadBoostrap.js" defer></script>
</head>
<body>
    <div id="head" class="Tophead d-flex flex-row align-items-center p-2">
        <div class="col-1 d-flex justify-content-center">
            <button id="Home" class="btn"><iconify-icon icon="ant-design:home-filled" style="color: #9747ff;" width="50" height="50"></iconify-icon></button>
        </div>
        <div class="col-5 d-flex justify-content-center">
            <h2 style="color: yellow;">帳號</h2>
        </div>
        <div class="col-6 d-flex justify-content-center">
            <div class="col-4 p-2">
                <a href="Props_Manager.html" class="btn btn-primary" style="width: 100%; height: auto; ;background-color: #B49971;">道具</a>
            </div>
            <div class="col-4 p-2">
                <a href="Modify_Password.html" class="btn btn-primary" style="width: 100%;background-color:#74B9E0;">修改密碼</a>
            </div>
            <div class="col-4 p-2">
                <a href="../Login.html" class="btn btn-primary container" style=" width: 100%;background-color: purple;">登出</a>
            </div>
        </div>
    </div>
    <div id="PersonalInformation" class="d-flex flex-row p-4">
        <div class="col-5 d-flex flex-column p-2 align-items-center">
            <div class="col d-flex align-items-center">
                <button id="EditPersonalInformation" type="button" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#EditPersonalInformationModal">修改資料</button>
            </div>
            <iconify-icon icon="mingcute:user-4-fill" style="color: #9747ff;" width="250" height="250"></iconify-icon>
            <span id="UserName">一夜秋</span>
            <div class="d-flex align-items-center">
            	<label for="UserID">ID:</label>
            	<span id="UserID">01</span>
            </div>
        </div>
        <div class="col-7 d-flex flex-column justify-content-evenly">
            <div class="d-flex align-items-center">
                <label for="LastName">姓：</label>
                <span id="LastName">葉</span>
            </div>
            <div class="d-flex align-items-center">
                <label for="FirstName">名：</label>
                <span id="FirstName">秋</span>
            </div>
            <div class="d-flex align-items-center">
                <label for="Birthday">出生日期：</label>
                <span id="Birthday">2001/12/29</span>
            </div>
            <div class="d-flex align-items-center">
                <label for="Email">Email：</label>
                <span id="Email">xxx@xxxxx.xxx</span>
            </div>
            <div class="d-flex align-items-center">
                <label for="Cellphone">電話：</label>
                <span id="Cellphone">0922-123456</span>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    
    <div class="modal fade modal-dialog modal-lg" id="EditPersonalInformationModal" tabindex="-1" aria-labelledby="EditPersonalInformationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="max-height: 700px;">
                <div class="modal-header d-flex flex-row justify-content-center " style="background-color: black;">
                    <h2 style="font-size: 30px;font-weight: 500; color: yellow;">修改資訊</h2>
                </div>
                <div class="modal-body d-flex flex-column" style="overflow-y: scroll; word-wrap: break-word;max-height:fit-content;">
                    <form id="EditForm">
                        <div class="input-group mb-2">
                            <label class="form-text" for="UserName_Edit">遊戲稱謂：</label>
                            <input class="form-control" id="UserName_Edit" placeholder="一夜秋"></input>
                        </div>
                        
                        <div class="input-group mb-2">
                            <label class="form-text" for="LastName_Edit">姓：</label>
                            <input class="form-control" id="LastName_Edit" placeholder="葉"></input>
                        </div>
                        <div class="input-group mb-2">
                            <label class="form-text"  for="FirstName_Edit">名：</label>
                            <input class="form-control" id="FirstName_Edit" placeholder="秋"></input>
                        </div>
                        <div class="input-group mb-2">
                            <label class="form-text"  for="Birthday_Edit">出生日期：</label>
                            <input class="form-control" id="Birthday_Edit" placeholder="2001-12-29"></input>
                            <div id="birthdayValidationFeedback" class="invalid-feedback">
                                請輸入有效的出生日期。
                            </div>
                        </div>
                        <div class="input-group mb-2">
                            <label class="form-text"  for="Email_Edit">Email：</label>
                            <input class="form-control" id="Email_Edit" placeholder="xxx@xxxxx.xxx"></input>
                            <div id="emailValidationFeedback" class="invalid-feedback">
                                請輸入有效的 Email 地址。
                            </div>
                        </div>
                        <div class="input-group mb-2">
                            <label class="form-text"  for="Cellphone_Edit">電話：</label>
                            <input class="form-control" id="Cellphone_Edit" placeholder="0922-123456"></input>
                            <div id="cellphoneValidationFeedback" class="invalid-feedback">
                                請輸入有效的電話號碼。
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="updateMember()">確認</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    document.getElementById("Home").addEventListener("click", function() {
        // if(authication=="一般使用者"){

        // }
        // else{}
        window.location.href = "../HomeList_NormalUser.html";
    });
        // get email input and verify the feedback element /獲取 email 輸入框和驗證反饋元素
    const birthdayInput = document.getElementById("Birthday_Edit");
    const birthdayValidationFeedback = document.getElementById("birthdayValidationFeedback");
    const emailInput = document.getElementById("Email_Edit");
    const emailValidationFeedback = document.getElementById("emailValidationFeedback");
    const cellphoneInput = document.getElementById("Cellphone_Edit");
    const cellphoneValidationFeedback = document.getElementById("cellphoneValidationFeedback");

    // Submit data and check
    document.getElementById("EditForm").addEventListener("submit", function (event) {
        // // Use regular expressions to verify the email format /使用正則表達式驗證 email 格式
        const birthdayPattern = /^\d{4}-\d{2}-\d{2}$/;
        let isValidBirthday = birthdayPattern.test(birthdayInput.value);
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        let isValidEmail = emailPattern.test(emailInput.value);
        const cellphonePattern = /^09\d{2}-\d{6}$/;
        let isValidCellphone = cellphonePattern.test(cellphoneInput.value);

        // // Update validation feedback /更新驗證反饋
        birthdayValidationFeedback.style.display = isValidBirthday ? "none" : "block";
        emailValidationFeedback.style.display = isValidEmail ? "none" : "block";
        cellphoneValidationFeedback.style.display = isValidCellphone ? "none" : "block";        

        // Check wether email is fit
        if(!isValidBirthday || !isValidEmail || !isValidCellphone){
            // stop submit behavior /阻止表單預設的提交行為
            event.preventDefault();
        }
    });
    
    function updateMember() {
        var name = $('#UserName_Edit').val(); // Modified: Use UserName_Edit instead of member_name
        var email = $('#Email_Edit').val(); // Modified: Use Email_Edit instead of member_email
        var lastName = $('#LastName_Edit').val(); // Modified: Use LastName_Edit instead of member_name
        var firstName = $('#FirstName_Edit').val(); // Modified: Use FirstName_Edit instead of member_name
        var birthday = $('#Birthday_Edit').val(); // Modified: Use Birthday_Edit instead of member_name
        var cellphone = $('#Cellphone_Edit').val(); // Modified: Use Cellphone_Edit instead of member_name
        
        $('#UserName').text(name);
        $('#LastName').text(lastName);
        $('#FirstName').text(firstName);
        $('#Birthday').text(birthday);
        $('#Email').text(email);
        $('#Cellphone').text(cellphone);

		var updatedMember = new Member(firstName, lastName, birthday, email, name, cellphone, /* password */);
        
		$.ajax({
            type: "PUT",
            url: "api/member.do", // Modify the URL accordingly
            data: updatedMember,
            success: function (response) {
                console.log(response);
                if (response.status == 200) {
                    // Modified: Update SQL log and fetch member details again
                    updateSQLTable(response.response);
                    getMember();
                    $('#EditPersonalInformationModal').modal('hide');
                }
            },
            error: function () {
                alert("無法連線到伺服器！");
            }
        });

        
        event.preventDefault();
    }
</script>
</html>